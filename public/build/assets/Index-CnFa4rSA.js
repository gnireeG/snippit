import{r as w,p as X,o as i,d as m,a as e,c as $,w as r,f as x,j as S,u as n,x as c,m as N,e as y,F as D,g as R,n as B,t as j,b,q as z,y as W,O as q,z as H,k as Y,A as Z}from"./app-MGLA-eMX.js";import{A as ee}from"./AppLayout-B4BwoHwO.js";import{a as E}from"./DropdownLink-Dsw7suN0.js";import{_ as M}from"./DialogModal-DdPxnp7c.js";import{h as C,_ as te}from"./SnippitCard-DnmoEjtZ.js";import{I as O}from"./InputComponent-BCWnfNbA.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Modal-XPiu1tLI.js";import"./CodeMirror-B6W5Xrr5.js";const le={class:"flex flex-col"},oe=e("i",{class:"bi bi-house-door-fill"},null,-1),se=["onDrop"],ae=["onClick"],ne=e("i",{class:"bi bi-caret-right-fill"},null,-1),re=[ne],ie=["title","onDblclick","onClick"],de=e("button",{title:"Options",class:"px-1"},[e("i",{class:"bi bi-three-dots"})],-1),ue={class:"rounded-lg p-2 flex"},ce=["onClick"],pe=e("i",{class:"bi bi-input-cursor-text text-lg"},null,-1),me=[pe],fe=["onClick"],he=e("i",{class:"bi bi-trash2 text-lg"},null,-1),be=[he],ve={key:0,class:"pl-1"},_e={key:1,class:"pl-3"},ge=["onSubmit"],we=e("button",{type:"submit",title:"Add folder"},[e("i",{class:"bi bi-folder-plus"})],-1),ye=["onUpdate:modelValue"],Fe=e("button",{type:"submit",title:"Add folder"},[e("i",{class:"bi bi-folder-plus"})],-1),xe=e("h3",{class:"heading-3"},"Delete folder",-1),ke=e("p",null,"All contents, including subfolders and Snippits will be deleted permanently.",-1),$e=e("h3",{class:"heading-3"},"Rename folder",-1),Se=["disabled"],Ce={__name:"FolderSelector",props:{folders:{type:Object,required:!0},root:{type:Boolean,default:!1}},emits:["navigate"],setup(k,{emit:s}){const v=w(!1),a=w(""),p=w(""),d=w(null);function F(t){d.value=t.id,a.value=t.name,v.value=!0,p.value=t.name}function g(){v.value=!1,a.value="",d.value=null,p.value=""}function u(){a.value!==p.value&&C.put(route("app.folders.rename",{folder_id:d.value,name:a.value})).then(t=>{if(t.status==200){if(c.commit("renameFolder",{folder:t.data.folder}),c.commit("addAlert",{type:"success",message:t.data.message}),c.state.currentFolder.id==t.data.folder.id){let o="/",_=window.location.pathname.split("/").filter(Boolean);_[_.length-1]=t.data.folder.slug,o+=_.join("/"),window.history.pushState({},"",o)}g()}})}const f=s,V=w(!1),A=w(null),I=w("");function G(t){A.value=t,V.value=!0}function U(){V.value=!1}function J(){A.value&&C.delete(route("app.folders.delete",{folder_id:A.value.id})).then(t=>{t.status==200&&(V.value=!1,c.commit("deleteFolder",t.data.deleted_folder),c.commit("addAlert",{type:"success",message:t.data.message}),c.state.currentFolder.id==t.data.deleted_folder.id&&q.visit(route("app.folders.index")))})}function T(t,o){if(t)L(t,o);else{let _=c.state.path.id;L(_,o)}}function L(t,o){C.post(route("app.folders.create"),{parent_id:t,name:o}).then(_=>{c.commit("addNewFolder",{folder:_.data,parentID:t})})}function K(t){!t.subfolders&&!t.loading?(t.loading=!0,C.get(route("app.folders.loadSubfoldersById",{folderId:t.id})).then(o=>{c.commit("addLoadedSubfolders",{subfolders:o.data,parentID:t.id})})):t.showSubfolders=!t.showSubfolders}function Q(t,o){q.visit(o+"?id="+t.id,{only:["folder"],onFinish:()=>{f("navigate")}})}function P(t,o){t.stopPropagation();const _=t.dataTransfer.getData("event"),l=t.dataTransfer.getData("snippitId");console.log(_,l,o),C.post(route("app.snippit.move"),{snippit_id:l,folder_id:o}).then(h=>{h.status==200&&(c.commit("addAlert",{type:"success",message:h.data.message}),c.commit("removeSnippit",{snippitId:l,folderId:o}))})}return(t,o)=>{const _=X("FolderSelector",!0);return i(),m(D,null,[e("div",{class:B([k.root?"py-2":""])},[e("div",le,[k.root?(i(),$(n(N),{key:0,onDragover:o[0]||(o[0]=S(()=>{},["prevent"])),onDrop:o[1]||(o[1]=l=>P(l,n(c).state.path.id)),href:t.route("app.folders.index"),class:"inline"},{default:r(()=>[oe,x(" Home")]),_:1},8,["href"])):y("",!0),(i(!0),m(D,null,R(k.folders,l=>(i(),m("div",{class:"pl-1 mt-0.5",onDragover:o[3]||(o[3]=S(()=>{},["prevent"])),onDrop:h=>P(h,l.id)},[e("div",{class:B(["flex items-center gap-2 text-sm whitespace-nowrap px-1 py-0.5 rounded-md group",[n(c).state.currentFolder.id==l.id?"bg-secondary":"bg-primary hover"]])},[e("button",{title:"Load subfolders",onClick:h=>K(l),class:B(["transform transition-transform py-0.5",[l.showSubfolders?"rotate-90":""]])},re,10,ae),e("button",{title:l.name,onDblclick:h=>F(l),onClick:h=>Q(l,n(c).state.pathToFolder(l.id)),class:"w-full text-left truncate py-0.5"},j(l.name),41,ie),b(E,{align:"right",width:"28",class:"md:opacity-0 md:group-hover:opacity-100"},{trigger:r(()=>[de]),content:r(()=>[e("div",ue,[e("button",{class:"btn btn-transparent w-full",title:"Rename folder",onClick:h=>F(l)},me,8,ce),e("button",{class:"btn btn-transparent w-full",title:"Delete folder",onClick:h=>G(l)},be,8,fe)])]),_:2},1024)],2),l.subfolders&&l.subfolders.length>0&&l.showSubfolders?(i(),m("div",ve,[b(_,{folders:l.subfolders,onNavigate:o[2]||(o[2]=h=>f("navigate"))},null,8,["folders"])])):y("",!0),l.showSubfolders?(i(),m("div",_e,[e("form",{onSubmit:S(()=>{T(l.id,l.newSubfolderName),l.newSubfolderName=""},["prevent"]),class:"flex gap-1"},[we,z(e("input",{type:"text",class:"bg-transparent border-0 p-0.5 flex-grow focus:ring-0 focus:outline-none min-w-11",placeholder:"Add new folder","onUpdate:modelValue":h=>l.newSubfolderName=h},null,8,ye),[[W,l.newSubfolderName]])],40,ge)])):y("",!0)],40,se))),256)),k.root?(i(),m("form",{key:1,onSubmit:o[5]||(o[5]=S(()=>{T(!1,I.value),I.value=""},["prevent"])),class:"flex gap-1 pl-2"},[Fe,z(e("input",{type:"text",class:"bg-transparent border-0 p-0.5 flex-grow focus:ring-0 focus:outline-none min-w-11",placeholder:"Add new folder","onUpdate:modelValue":o[4]||(o[4]=l=>I.value=l)},null,512),[[W,I.value]])],32)):y("",!0)])],2),b(M,{show:V.value,onClose:U,maxWidth:"xl"},{title:r(()=>[xe]),content:r(()=>[e("p",null,[x("Are you sure you want to delete the folder "),e("b",null,j(A.value.name),1),x("?")]),ke]),footer:r(()=>[e("button",{class:"btn",onClick:U},"Cancel"),e("button",{class:"btn btn-danger",onClick:J},"Delete")]),_:1},8,["show"]),b(M,{show:v.value,onClose:g,maxWidth:"xl"},{title:r(()=>[$e]),content:r(()=>[e("form",{onSubmit:S(u,["prevent"])},[b(O,{modelValue:a.value,"onUpdate:modelValue":o[6]||(o[6]=l=>a.value=l),label:"New folder name",placeholder:"New folder name",autofocus:!0,bgClass:"bg-primary"},null,8,["modelValue"])],32)]),footer:r(()=>[e("button",{class:"btn",onClick:g},"Cancel"),e("button",{class:"btn btn-success",onClick:u,disabled:a.value==p.value},"Rename",8,Se)]),_:1},8,["show"])],64)}}},Ne={key:0,class:"flex gap-2"},De=e("i",{class:"bi bi-chevron-right"},null,-1),Ve={key:0,class:"bi bi-chevron-right"},Ae={__name:"FolderBreadcrumbs",setup(k){const s=H(),v=Y(()=>{let a=s.getters.simplePath;return a?(a.shift(),a=a.map((p,d)=>{const F="/app/folder/"+a.slice(0,d+1).map(g=>g.slug).join("/");return{...p,pathSlug:F}}),a):[]});return(a,p)=>n(s).state.path?(i(),m("div",Ne,[b(n(N),{href:a.route("app.folders.index")},{default:r(()=>[x("Home")]),_:1},8,["href"]),De,(i(!0),m(D,null,R(v.value,(d,F)=>(i(),m(D,null,[b(n(N),{href:d.pathSlug},{default:r(()=>[x(j(d.name),1)]),_:2},1032,["href"]),F!==v.value.length-1?(i(),m("i",Ve)):y("",!0)],64))),256))])):y("",!0)}},Ie={class:"flex gap-4 relative flex-col md:flex-row"},je={class:"min-w-64 flex-grow relative"},Be={class:"top-0 sticky max-h-48 md:max-h-none overflow-y-auto md:overflow-y-visible pb-10 md:pb-0"},Me={class:"w-full mt-8"},Oe={class:"flex justify-between items-center"},Re={class:"text-sm mb-2"},Ue={key:0,class:"heading-1"},Te={key:1,class:"heading-1"},Le=e("button",{class:"btn"},[x("New "),e("i",{class:"bi bi-plus-lg"})],-1),Pe={class:"rounded-lg p-2"},ze=e("i",{class:"bi bi-code-slash"},null,-1),We=e("i",{class:"bi bi-folder"},null,-1),qe={class:"flex justify-end"},He={class:"autogrid gap-4 w-full mt-4"},Ee=e("i",{class:"bi bi-plus-circle-dotted text-2xl"},null,-1),Ge=e("p",null,"Create new Snippit",-1),Je=e("h3",{class:"heading-3"},"New Folder",-1),Ke=["disabled"],at={__name:"Index",props:{folder:Object,path:Object,simplePath:Object},setup(k){const s=H(),v=w(""),a=k;Z(()=>{s.commit("initFolderData",{currentFolder:a.folder,path:a.path})});const p=w(!1),d=w("");function F(){d.value.length<3||(C.post(route("app.folders.create"),{parent_id:s.state.currentFolder.id,name:d.value}).then(g=>{s.commit("addNewFolder",{folder:g.data,parentID:s.state.currentFolder.id})}),p.value=!1,d.value="")}return(g,u)=>(i(),$(ee,{title:"Folders"},{default:r(()=>[e("div",null,[e("div",Ie,[e("div",je,[e("div",Be,[n(s).state.path?(i(),$(Ce,{key:0,root:!0,folders:n(s).state.path.subfolders,onNavigate:u[0]||(u[0]=f=>v.value="")},null,8,["folders"])):y("",!0)])]),e("div",Me,[e("div",Oe,[e("div",null,[e("p",Re,[b(Ae)]),n(s).state.currentFolder?(i(),m("h1",Ue,j(n(s).state.currentFolder.name),1)):(i(),m("h1",Te,"Root"))]),b(E,{align:"right",width:"48"},{trigger:r(()=>[Le]),content:r(()=>[e("div",Pe,[n(s).state.currentFolder?(i(),$(n(N),{key:0,href:g.route("app.snippit.showCreate")+"?folder_id="+n(s).state.currentFolder.id,class:"btn btn-transparent w-full block text-center"},{default:r(()=>[ze,x(" Snippit")]),_:1},8,["href"])):y("",!0),e("button",{class:"btn btn-transparent w-full",onClick:u[1]||(u[1]=f=>p.value=!0)},[We,x(" Folder")])])]),_:1})]),e("div",qe,[b(O,{modelValue:v.value,"onUpdate:modelValue":u[2]||(u[2]=f=>v.value=f),placeholder:"Search",type:"search",bgClass:"bg-primary",size:"sm"},null,8,["modelValue"])]),e("div",He,[n(s).state.currentFolder?(i(!0),m(D,{key:0},R(n(s).state.currentFolder.snippits,f=>(i(),$(te,{snippit:f,draggable:!0,deleteAble:!0,searchValue:v.value},null,8,["snippit","searchValue"]))),256)):y("",!0),n(s).state.currentFolder?(i(),$(n(N),{key:1,title:"New Snippit",href:g.route("app.snippit.showCreate")+"?folder_id="+n(s).state.currentFolder.id,class:"border-2 border-dashed border-gray-400 flex justify-center items-center flex-col p-4"},{default:r(()=>[Ee,Ge]),_:1},8,["href"])):y("",!0)])])])]),b(M,{show:p.value,onClose:u[5]||(u[5]=f=>p.value=!1),maxWidth:"xl"},{title:r(()=>[Je]),content:r(()=>[e("div",null,[e("form",{onSubmit:S(F,["prevent"])},[b(O,{modelValue:d.value,"onUpdate:modelValue":u[3]||(u[3]=f=>d.value=f),label:"Folder Name"},null,8,["modelValue"])],32)])]),footer:r(()=>[e("button",{onClick:u[4]||(u[4]=f=>p.value=!1),class:"textlink"},"Cancel"),e("button",{class:"btn",disabled:d.value.length<3,onClick:F},"Save",8,Ke)]),_:1},8,["show"])]),_:1}))}};export{at as default};
