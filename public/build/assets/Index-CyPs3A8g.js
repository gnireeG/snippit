import{x as U,y as f,r as S,p as W,o as a,d as c,a as e,c as $,w as i,f as y,j as k,u as r,m as D,e as w,F as C,g as V,n as A,t as N,b as x,q as j,z as B,O as q,A as M,k as z,B as E}from"./app-xjV7HbQ7.js";import{A as H}from"./AppLayout-C1uODMaV.js";import{a as O}from"./DropdownLink-B9wMdZmR.js";import{_ as P}from"./DialogModal-DwxoQh90.js";import{_ as R}from"./SnippitCard-CdhX14R8.js";import{_ as G}from"./InputComponent-i5DvzUZi.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Modal-BIoZUSYm.js";import"./CodeMirror-DpY-DzQd.js";const F=U.create();F.interceptors.response.use(p=>p,p=>{var d,n;const l=((n=(d=p.response)==null?void 0:d.data)==null?void 0:n.message)||"An error occurred";return f.commit("addAlert",{type:"error",message:l}),Promise.reject(p)});const J={class:"flex flex-col"},K=e("i",{class:"bi bi-house-door-fill"},null,-1),Q=["onDrop"],X=["onClick"],Y=e("i",{class:"bi bi-caret-right-fill"},null,-1),Z=[Y],ee=["title","onClick"],te=e("button",{title:"Options",class:"px-1"},[e("i",{class:"bi bi-three-dots"})],-1),oe={class:"rounded-lg p-2 flex"},se=e("button",{class:"btn btn-transparent w-full",title:"Rename folder"},[e("i",{class:"bi bi-input-cursor-text text-lg"})],-1),le=["onClick"],ne=e("i",{class:"bi bi-trash2 text-lg"},null,-1),ae=[ne],re={key:0,class:"pl-1"},ie={key:1,class:"pl-3"},de=["onSubmit"],ue=e("button",{type:"submit",title:"Add folder"},[e("i",{class:"bi bi-folder-plus"})],-1),ce=["onUpdate:modelValue"],pe=e("button",{type:"submit",title:"Add folder"},[e("i",{class:"bi bi-folder-plus"})],-1),fe=e("h3",{class:"heading-3"},"Delete folder",-1),me=e("p",null,"All contents, including subfolders and Snippits will be deleted permanently.",-1),he={__name:"FolderSelector",props:{folders:{type:Object,required:!0},root:{type:Boolean,default:!1}},setup(p){const l=S(!1),d=S(null),n=S("");function m(o){d.value=o,l.value=!0}function _(){l.value=!1}function v(){d.value&&F.delete(route("app.folders.delete",{folder_id:d.value.id})).then(o=>{o.status==200&&(l.value=!1,f.commit("deleteFolder",o.data.deleted_folder),f.commit("addAlert",{type:"success",message:o.data.message}),f.state.currentFolder.id==o.data.deleted_folder.id&&q.visit(route("app.folders.index")))})}function u(o,s){if(o)g(o,s);else{let h=f.state.path.id;g(h,s)}}function g(o,s){F.post(route("app.folders.create"),{parent_id:o,name:s}).then(h=>{f.commit("addNewFolder",{folder:h.data,parentID:o})})}function L(o){!o.subfolders&&!o.loading?(o.loading=!0,F.get(route("app.folders.loadSubfoldersById",{folderId:o.id})).then(s=>{f.commit("addLoadedSubfolders",{subfolders:s.data,parentID:o.id})})):o.showSubfolders=!o.showSubfolders}function T(o){F.get(route("app.folders.loadFolderWithContent",{folderId:o.id})).then(s=>{let h="/folder/";s.data.path.forEach((t,b)=>{b<s.data.path.length-1?h+=t.slug+"/":h+=t.slug}),window.history.pushState({},"",h),f.commit("updateCurrentFolder",s.data.folder)})}function I(o,s){o.stopPropagation();const h=o.dataTransfer.getData("event"),t=o.dataTransfer.getData("snippitId");console.log(h,t,s),F.post(route("app.snippit.move"),{snippit_id:t,folder_id:s}).then(b=>{b.status==200&&(f.commit("addAlert",{type:"success",message:b.data.message}),f.commit("removeSnippit",{snippitId:t,folderId:s}))})}return(o,s)=>{const h=W("FolderSelector",!0);return a(),c(C,null,[e("div",{class:A([p.root?"py-2":""])},[e("div",J,[p.root?(a(),$(r(D),{key:0,onDragover:s[0]||(s[0]=k(()=>{},["prevent"])),onDrop:s[1]||(s[1]=t=>I(t,r(f).state.path.id)),href:o.route("app.folders.index"),class:"inline"},{default:i(()=>[K,y(" Home")]),_:1},8,["href"])):w("",!0),(a(!0),c(C,null,V(p.folders,t=>(a(),c("div",{class:"pl-1 mt-0.5",onDragover:s[2]||(s[2]=k(()=>{},["prevent"])),onDrop:b=>I(b,t.id)},[e("div",{class:A(["flex items-center gap-2 text-sm whitespace-nowrap px-1 py-0.5 rounded-md group",[r(f).state.currentFolder.id==t.id?"bg-secondary":"bg-primary hover"]])},[e("button",{title:"Load subfolders",onClick:b=>L(t),class:A(["transform transition-transform py-0.5",[t.showSubfolders?"rotate-90":""]])},Z,10,X),e("button",{title:t.name,onClick:b=>T(t),class:"w-full text-left truncate"},N(t.name),9,ee),x(O,{align:"right",width:"28",class:"md:opacity-0 md:group-hover:opacity-100"},{trigger:i(()=>[te]),content:i(()=>[e("div",oe,[se,e("button",{class:"btn btn-transparent w-full",title:"Delete folder",onClick:b=>m(t)},ae,8,le)])]),_:2},1024)],2),t.subfolders&&t.subfolders.length>0&&t.showSubfolders?(a(),c("div",re,[x(h,{folders:t.subfolders},null,8,["folders"])])):w("",!0),t.showSubfolders?(a(),c("div",ie,[e("form",{onSubmit:k(()=>{u(t.id,t.newSubfolderName),t.newSubfolderName=""},["prevent"]),class:"flex gap-1"},[ue,j(e("input",{type:"text",class:"bg-transparent border-0 p-0.5 flex-grow focus:ring-0 focus:outline-none min-w-11",placeholder:"Add new folder","onUpdate:modelValue":b=>t.newSubfolderName=b},null,8,ce),[[B,t.newSubfolderName]])],40,de)])):w("",!0)],40,Q))),256)),p.root?(a(),c("form",{key:1,onSubmit:s[4]||(s[4]=k(()=>{u(!1,n.value),n.value=""},["prevent"])),class:"flex gap-1 pl-2"},[pe,j(e("input",{type:"text",class:"bg-transparent border-0 p-0.5 flex-grow focus:ring-0 focus:outline-none min-w-11",placeholder:"Add new folder","onUpdate:modelValue":s[3]||(s[3]=t=>n.value=t)},null,512),[[B,n.value]])],32)):w("",!0)])],2),x(P,{show:l.value,onClose:_,maxWidth:"xl"},{title:i(()=>[fe]),content:i(()=>[e("p",null,[y("Are you sure you want to delete the folder "),e("b",null,N(d.value.name),1),y("?")]),me]),footer:i(()=>[e("button",{class:"btn",onClick:_},"Cancel"),e("button",{class:"btn btn-danger",onClick:v},"Delete")]),_:1},8,["show"])],64)}}},be={key:0,class:"flex gap-2"},_e=e("i",{class:"bi bi-chevron-right"},null,-1),ve={key:0,class:"bi bi-chevron-right"},ge={__name:"FolderBreadcrumbs",setup(p){const l=M(),d=z(()=>{let n=l.getters.simplePath;return n?(n.shift(),n=n.map((m,_)=>{const v="/folder/"+n.slice(0,_+1).map(u=>u.slug).join("/");return{...m,pathSlug:v}}),n):[]});return(n,m)=>r(l).state.path?(a(),c("div",be,[x(r(D),{href:n.route("app.folders.index")},{default:i(()=>[y("Home")]),_:1},8,["href"]),_e,(a(!0),c(C,null,V(d.value,(_,v)=>(a(),c(C,null,[x(r(D),{href:_.pathSlug},{default:i(()=>[y(N(_.name),1)]),_:2},1032,["href"]),v!==d.value.length-1?(a(),c("i",ve)):w("",!0)],64))),256))])):w("",!0)}},we={class:"flex gap-4 relative flex-col md:flex-row"},xe={class:"min-w-64 flex-grow relative"},ye={class:"top-0 sticky max-h-48 md:max-h-none overflow-y-auto md:overflow-y-visible pb-10 md:pb-0"},Fe={class:"w-full mt-8"},$e={class:"flex justify-between"},ke={class:"text-sm mb-2"},Se={key:0,class:"heading-1"},Ce={key:1,class:"heading-1"},De=e("button",{class:"btn"},[y("New "),e("i",{class:"bi bi-plus-lg"})],-1),Ne={class:"rounded-lg p-2"},Ae=e("i",{class:"bi bi-code-slash"},null,-1),Ve=e("i",{class:"bi bi-folder"},null,-1),Ie={class:"autogrid gap-4 w-full mt-4"},je=e("h3",{class:"heading-3"},"New Folder",-1),Be=["disabled"],Ee={__name:"Index",props:{folder:Object,path:Object,simplePath:Object},setup(p){const l=M(),d=p;E(()=>{l.commit("initFolderData",{currentFolder:d.folder,path:d.path})});const n=S(!1),m=S("");function _(){m.value.length<3||(F.post(route("app.folders.create"),{parent_id:l.state.currentFolder.id,name:m.value}).then(v=>{l.commit("addNewFolder",{folder:v.data,parentID:l.state.currentFolder.id})}),n.value=!1,m.value="")}return(v,u)=>(a(),$(H,{title:"Folders"},{default:i(()=>[e("div",null,[e("div",we,[e("div",xe,[e("div",ye,[r(l).state.path?(a(),$(he,{key:0,root:!0,folders:r(l).state.path.subfolders},null,8,["folders"])):w("",!0)])]),e("div",Fe,[e("div",$e,[e("div",null,[e("p",ke,[x(ge)]),r(l).state.currentFolder?(a(),c("h1",Se,N(r(l).state.currentFolder.name),1)):(a(),c("h1",Ce,"Root"))]),x(O,{align:"right",width:"48"},{trigger:i(()=>[De]),content:i(()=>[e("div",Ne,[r(l).state.currentFolder?(a(),$(r(D),{key:0,href:v.route("app.snippit.showCreate")+"?folder_id="+r(l).state.currentFolder.id,class:"btn btn-transparent w-full block text-center"},{default:i(()=>[Ae,y(" Snippit")]),_:1},8,["href"])):w("",!0),e("button",{class:"btn btn-transparent w-full",onClick:u[0]||(u[0]=g=>n.value=!0)},[Ve,y(" Folder")])])]),_:1})]),e("div",Ie,[r(l).state.currentFolder?(a(!0),c(C,{key:0},V(r(l).state.currentFolder.snippits,g=>(a(),$(R,{snippit:g,draggable:!0},null,8,["snippit"]))),256)):w("",!0)])])])]),x(P,{show:n.value,onClose:u[3]||(u[3]=g=>n.value=!1),maxWidth:"xl"},{title:i(()=>[je]),content:i(()=>[e("div",null,[e("form",{onSubmit:k(_,["prevent"])},[x(G,{modelValue:m.value,"onUpdate:modelValue":u[1]||(u[1]=g=>m.value=g),label:"Folder Name"},null,8,["modelValue"])],32)])]),footer:i(()=>[e("button",{onClick:u[2]||(u[2]=g=>n.value=!1),class:"textlink"},"Cancel"),e("button",{class:"btn",disabled:m.value.length<3,onClick:_},"Save",8,Be)]),_:1},8,["show"])]),_:1}))}};export{Ee as default};
